<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TeamSense - Supervisor Control Surface v2</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { font-family: 'Urbanist', sans-serif; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fadeIn { animation: fadeIn 0.35s ease-out; }
    @keyframes typing { 0%,80%,100% { transform: scale(0.5); opacity: 0.3; } 40% { transform: scale(1); opacity: 1; } }
    .typing-dot { animation: typing 1.4s infinite; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    .carousel-wrap { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; scrollbar-width: none; gap: 10px; padding: 4px 2px; }
    .carousel-wrap::-webkit-scrollbar { display: none; }
    .carousel-item { scroll-snap-align: start; flex-shrink: 0; }
    .chat-scroll::-webkit-scrollbar { width: 3px; }
    .chat-scroll::-webkit-scrollbar-thumb { background: #ccc; border-radius: 2px; }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .panel-slide { animation: slideUp 0.3s ease-out; }
    @keyframes chipPop { from { opacity:0; transform: scale(0.9); } to { opacity:1; transform: scale(1); } }
    .chip-pop { animation: chipPop 0.25s ease-out; }
    .chip-pop:nth-child(2) { animation-delay: 0.05s; }
    .chip-pop:nth-child(3) { animation-delay: 0.1s; }
    .chip-pop:nth-child(4) { animation-delay: 0.15s; }
  </style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, createContext, useContext } = React;

    // ===== BRAND =====
    const B = { teal: '#263D39', tealLight: '#6DAEA2', offWhite: '#F5FAF8', yellow: '#F6B725', orange: '#BF4B08', coral: '#FF957D' };

    // ===== ICONS (minimal SVG) =====
    const Ic = ({ d, size=20, cls="" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24"
        fill="none" stroke="currentColor" strokeWidth={2} strokeLinecap="round" strokeLinejoin="round" className={cls}>
        {(Array.isArray(d)?d:[d]).map((p,i) => <path key={i} d={p}/>)}
      </svg>
    );
    const Icons = {
      users: (p) => <Ic {...p} d={["M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2","M9 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z","M22 21v-2a4 4 0 0 0-3-3.87","M16 3.13a4 4 0 0 1 0 7.75"]}/>,
      check: (p) => <Ic {...p} d="M20 6L9 17l-5-5"/>,
      checkCircle: (p) => <Ic {...p} d={["M22 11.08V12a10 10 0 1 1-5.93-9.14","M22 4L12 14.01l-3-3"]}/>,
      alert: (p) => <Ic {...p} d={["M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z","M12 9v4","M12 17h.01"]}/>,
      clock: (p) => <Ic {...p} d={["M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z","M12 6v6l4 2"]}/>,
      send: (p) => <Ic {...p} d={["M22 2L11 13","M22 2l-7 20-4-9-9-4 20-7z"]}/>,
      phone: (p) => <Ic {...p} d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.14.9.35 1.78.63 2.63a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.85.28 1.73.49 2.63.63A2 2 0 0 1 22 16.92z"/>,
      shield: (p) => <Ic {...p} d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>,
      file: (p) => <Ic {...p} d={["M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z","M14 2v6h6","M16 13H8","M16 17H8","M10 9H8"]}/>,
      trending: (p) => <Ic {...p} d={["M23 6l-9.5 9.5-5-5L1 18","M17 6h6v6"]}/>,
      refresh: (p) => <Ic {...p} d={["M23 4v6h-6","M1 20v-6h6","M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"]}/>,
      x: (p) => <Ic {...p} d={["M18 6L6 18","M6 6l12 12"]}/>,
      barChart: (p) => <Ic {...p} d={["M18 20V10","M12 20V4","M6 20v-6"]}/>,
      bot: (p) => <Ic {...p} d={["M12 8V4H8","M2 12h2","M20 12h2","M6 8h12a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2z","M9 14v0","M15 14v0"]}/>,
      user: (p) => <Ic {...p} d={["M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2","M9 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"]}/>,
      star: (p) => <Ic {...p} d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>,
      msg: (p) => <Ic {...p} d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>,
      settings: (p) => <Ic {...p} d={["M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z","M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"]}/>
    };

    // ===== EMPLOYEE DATA =====
    const REVIEW_CARDS = [
      { name:'Maria Garcia', role:'Line A ‚Äî Assembly', status:'No Badge / No Call', statusCls:'bg-red-100 text-red-700', barCls:'bg-red-500', avatar:'MG', avatarBg:'bg-red-400', detail:'3 absences in 30 days', points:6, risk:'High' },
      { name:'Kevin Park', role:'Line B ‚Äî Quality Check', status:'Late Arrival (6:47 AM)', statusCls:'bg-yellow-100 text-yellow-700', barCls:'bg-yellow-400', avatar:'KP', avatarBg:'bg-yellow-500', detail:'Badged in ¬∑ On floor now', points:1, risk:'Low' }
    ];
    const BACKFILL_CARDS = [
      { name:'Lisa Chen', role:'Line A qualified', status:'Off Today ‚Äî Available', statusCls:'bg-green-100 text-green-700', barCls:'bg-green-500', avatar:'LC', avatarBg:'bg-emerald-500', detail:'Backfill acceptance rate: 80%', badge:'Recommended', badgeCls:'bg-green-100 text-green-700' },
      { name:'Tom Davis', role:'Cross-trained Line A', status:'Different Shift', statusCls:'bg-blue-100 text-blue-700', barCls:'bg-blue-400', avatar:'TD', avatarBg:'bg-blue-500', detail:'Backfill acceptance rate: 45%', badge:null }
    ];

    // ===== FULL SHIFT DATA (for table views) =====
    const SHIFT_DATA = [
      { name:'Carlos Mendez', dept:'Line A', time:'6:00 AM', status:'Present', tier:'Tier 3', points:0, by:'Auto' },
      { name:'Maria Garcia', dept:'Line A', time:'‚Äî', status:'NCNS', tier:'Tier 1', points:7, by:'Sal (Sup)' },
      { name:'Lisa Chen', dept:'Line A', time:'7:15 AM', status:'Backfill', tier:'Tier 2', points:0, by:'Sal ‚Üí Agent' },
      { name:'Ahmed Hassan', dept:'Line A', time:'5:55 AM', status:'Present', tier:'Tier 3', points:2, by:'Auto' },
      { name:'Jennifer Walsh', dept:'Line A', time:'5:58 AM', status:'Present', tier:'Tier 3', points:0, by:'Auto' },
      { name:'Robert Kim', dept:'Line A', time:'5:52 AM', status:'Present', tier:'Tier 3', points:1, by:'Auto' },
      { name:'Diana Torres', dept:'Line A', time:'5:57 AM', status:'Present', tier:'Tier 3', points:0, by:'Auto' },
      { name:'Marcus Brown', dept:'Line A', time:'5:50 AM', status:'Present', tier:'Tier 3', points:3, by:'Auto' },
      { name:'Kevin Park', dept:'Line B', time:'6:47 AM', status:'Present (Late)', tier:'Tier 1', points:2, by:'Sal (Sup)' },
      { name:'Sarah Miller', dept:'Line B', time:'5:54 AM', status:'Present', tier:'Tier 3', points:0, by:'Auto' },
      { name:'James Wright', dept:'Line B', time:'5:56 AM', status:'Present', tier:'Tier 3', points:5, by:'Auto' },
      { name:'Priya Patel', dept:'Line B', time:'5:59 AM', status:'Present', tier:'Tier 3', points:0, by:'Auto' },
      { name:'Tony Russo', dept:'Line B', time:'5:53 AM', status:'Present', tier:'Tier 3', points:1, by:'Auto' },
      { name:'Angela Davis', dept:'Line B', time:'5:51 AM', status:'Present', tier:'Tier 3', points:0, by:'Auto' },
      { name:'David Chang', dept:'Line B', time:'5:58 AM', status:'Present', tier:'Tier 3', points:2, by:'Auto' },
      { name:'Nicole Foster', dept:'Line B', time:'5:55 AM', status:'Present', tier:'Tier 3', points:0, by:'Auto' }
    ];

    // ===== CONVERSATION SCENES =====
    const SCENES = {
      start: {
        messages: [
          { ch:'sms', from:'agent', text:"Good morning Sal. 14/16 confirmed on Line A/B. 2 need your review. Sending details now.", time:'5:58 AM', delay:1200 }
        ],
        autoNext:'review', autoDelay:2000
      },
      review: {
        messages: [
          { ch:'rcs', from:'agent', text:"2 employees need your confirmation:", time:'5:58 AM', delay:1500 },
          { ch:'rcs', from:'agent', type:'carousel', cards: REVIEW_CARDS, time:'5:58 AM', delay:800 }
        ],
        chips: [
          { label:'Maria ‚Üí NCNS', userMsg:'Mark Maria as No-Call/No-Show', next:'maria-ncns' },
          { label:'Maria ‚Üí Excused', userMsg:'Mark Maria as excused absence', next:'maria-excused' }
        ]
      },
      'maria-ncns': {
        messages: [
          { ch:'rcs', from:'agent', text:"Got it. Maria Garcia marked No-Call/No-Show.\n+3 points applied ‚Üí she's now at 7 points.\n\nNow ‚Äî how about Kevin Park? He badged in at 6:47 AM and is on the floor.", time:'5:59 AM', delay:1800 }
        ],
        chips: [
          { label:'Kevin ‚Üí Present (Late)', userMsg:'Kevin is here, mark him late', next:'kevin-late' },
          { label:'Kevin ‚Üí Present (On Time)', userMsg:"He's fine, mark on time", next:'kevin-ontime' }
        ]
      },
      'maria-excused': {
        messages: [
          { ch:'rcs', from:'agent', text:"Maria Garcia marked Excused Absence. No points applied.\n\nNow ‚Äî Kevin Park badged in at 6:47 AM. He's on the floor.", time:'5:59 AM', delay:1500 }
        ],
        chips: [
          { label:'Kevin ‚Üí Present (Late)', userMsg:'Kevin is here, mark him late', next:'kevin-late-no-alert' },
          { label:'Kevin ‚Üí Present (On Time)', userMsg:"He's fine, mark on time", next:'kevin-ontime-no-alert' }
        ]
      },
      'kevin-late': {
        messages: [
          { ch:'sms', from:'agent', text:"Kevin Park confirmed present ‚Äî late arrival noted. +1 point (now 2 total).", time:'6:00 AM', delay:1200 },
          { ch:'rcs', from:'agent', type:'alert', text:"‚ö†Ô∏è Points Alert\n\nMaria Garcia is now at 7 points ‚Äî one incident away from the Written Warning threshold (8 pts).\n\nWant me to notify HR proactively?", time:'6:00 AM', delay:2000 }
        ],
        chips: [
          { label:'Yes, Notify HR', userMsg:'Yes, notify HR about Maria', next:'notify-hr' },
          { label:'Not Yet', userMsg:'Hold off on HR for now', next:'hold-hr' },
          { label:'Add Context Note', userMsg:'Let me add context first', next:'add-note' }
        ]
      },
      'kevin-ontime': {
        messages: [
          { ch:'sms', from:'agent', text:"Kevin Park confirmed present and on time. No points.", time:'6:00 AM', delay:1000 },
          { ch:'rcs', from:'agent', type:'alert', text:"‚ö†Ô∏è Points Alert\n\nMaria Garcia is now at 7 points ‚Äî one incident away from Written Warning (8 pts).\n\nWant me to notify HR?", time:'6:00 AM', delay:2000 }
        ],
        chips: [
          { label:'Yes, Notify HR', userMsg:'Yes, notify HR about Maria', next:'notify-hr' },
          { label:'Not Yet', userMsg:'Hold off for now', next:'hold-hr' }
        ]
      },
      'kevin-late-no-alert': {
        messages: [
          { ch:'sms', from:'agent', text:"Kevin Park confirmed present ‚Äî late arrival noted. +1 point (now 2 total).", time:'6:00 AM', delay:1200 },
          { ch:'sms', from:'agent', text:"All employees accounted for. Line A needs coverage for Maria ‚Äî want me to find backfill?", time:'6:00 AM', delay:1500 }
        ],
        chips: [
          { label:'Yes, Find Backfill', userMsg:'Yes, find someone for Line A', next:'backfill' },
          { label:'Skip Backfill', userMsg:"We'll manage without", next:'summary' }
        ]
      },
      'kevin-ontime-no-alert': {
        messages: [
          { ch:'sms', from:'agent', text:"Kevin Park confirmed present, on time.", time:'6:00 AM', delay:1000 },
          { ch:'sms', from:'agent', text:"All employees accounted for. Maria's spot on Line A needs coverage. Want me to find backfill?", time:'6:01 AM', delay:1500 }
        ],
        chips: [
          { label:'Yes, Find Backfill', userMsg:'Yes, find someone', next:'backfill' },
          { label:'Skip', userMsg:"We'll manage", next:'summary' }
        ]
      },
      'notify-hr': {
        messages: [
          { ch:'sms', from:'agent', text:"HR notified ‚Äî flagged Maria Garcia for approaching Written Warning threshold.", time:'6:01 AM', delay:1200 },
          { ch:'rcs', from:'agent', text:"Maria's Line A spot needs coverage. I found 2 qualified candidates available:", time:'6:01 AM', delay:1500 },
          { ch:'rcs', from:'agent', type:'carousel', cards: BACKFILL_CARDS, time:'6:01 AM', delay:800 }
        ],
        chips: [
          { label:'Text Lisa (Recommended)', userMsg:'Text Lisa Chen for backfill', next:'text-lisa' },
          { label:'Text Tom', userMsg:'Text Tom Davis instead', next:'text-tom' },
          { label:'Skip Backfill', userMsg:'Skip backfill for now', next:'summary' }
        ]
      },
      'hold-hr': {
        messages: [
          { ch:'sms', from:'agent', text:"Noted ‚Äî holding off on HR for now. I'll keep tracking Maria's status.", time:'6:01 AM', delay:1000 },
          { ch:'rcs', from:'agent', text:"Maria's Line A spot still needs coverage. 2 candidates available:", time:'6:01 AM', delay:1500 },
          { ch:'rcs', from:'agent', type:'carousel', cards: BACKFILL_CARDS, time:'6:01 AM', delay:800 }
        ],
        chips: [
          { label:'Text Lisa', userMsg:'Text Lisa Chen', next:'text-lisa' },
          { label:'Text Tom', userMsg:'Text Tom Davis', next:'text-tom' },
          { label:'Skip', userMsg:'Skip backfill', next:'summary' }
        ]
      },
      'add-note': {
        messages: [
          { ch:'rcs', from:'agent', text:"What context would you like to add about Maria?", time:'6:01 AM', delay:1000 }
        ],
        chips: [
          { label:'Pattern ‚Äî Monday absences', userMsg:'Note: Maria has a pattern of Monday absences, this is the 3rd in 5 weeks', next:'note-added' },
          { label:'Spoke to her Friday', userMsg:'Note: I spoke with Maria Friday about her attendance', next:'note-added' },
          { label:'Skip note, notify HR', userMsg:'Actually just notify HR', next:'notify-hr' }
        ]
      },
      'note-added': {
        messages: [
          { ch:'sms', from:'agent', text:"Note added to Maria's record. HR notified with your context included.", time:'6:01 AM', delay:1200 },
          { ch:'rcs', from:'agent', text:"Now ‚Äî Maria's Line A spot needs coverage:", time:'6:01 AM', delay:1500 },
          { ch:'rcs', from:'agent', type:'carousel', cards: BACKFILL_CARDS, time:'6:01 AM', delay:800 }
        ],
        chips: [
          { label:'Text Lisa (Recommended)', userMsg:'Text Lisa Chen', next:'text-lisa' },
          { label:'Text Tom', userMsg:'Text Tom Davis', next:'text-tom' },
          { label:'Skip', userMsg:'Skip backfill', next:'summary' }
        ]
      },
      backfill: {
        messages: [
          { ch:'rcs', from:'agent', text:"I found 2 qualified candidates for Line A:", time:'6:01 AM', delay:1200 },
          { ch:'rcs', from:'agent', type:'carousel', cards: BACKFILL_CARDS, time:'6:01 AM', delay:800 }
        ],
        chips: [
          { label:'Text Lisa (Recommended)', userMsg:'Text Lisa Chen', next:'text-lisa' },
          { label:'Text Tom', userMsg:'Text Tom Davis', next:'text-tom' }
        ]
      },
      'text-lisa': {
        messages: [
          { ch:'sms', from:'agent', text:"Backfill request sent to Lisa Chen. I'll let you know when she responds.", time:'6:02 AM', delay:1000 }
        ],
        autoNext:'lisa-accepted', autoDelay:3500
      },
      'text-tom': {
        messages: [
          { ch:'sms', from:'agent', text:"Backfill request sent to Tom Davis. I'll let you know when he responds.", time:'6:02 AM', delay:1000 }
        ],
        autoNext:'tom-accepted', autoDelay:3500
      },
      'lisa-accepted': {
        messages: [
          { ch:'sms', from:'agent', text:"‚úì Lisa Chen accepted. She'll arrive by 7:15 AM. Line A is covered.", time:'6:15 AM', delay:1500 }
        ],
        autoNext:'summary', autoDelay:2500
      },
      'tom-accepted': {
        messages: [
          { ch:'sms', from:'agent', text:"‚úì Tom Davis accepted. He'll switch shifts and cover Line A. Coverage confirmed.", time:'6:18 AM', delay:1500 }
        ],
        autoNext:'summary', autoDelay:2500
      },
      summary: {
        messages: [
          { ch:'sms', from:'agent', text:"Shift wrap-up ‚Äî Line A/B\n\n‚Ä¢ 15/16 present (1 NCNS)\n‚Ä¢ Backfill: covered\n‚Ä¢ Auto-confirmed: 14 employees\n‚Ä¢ Supervisor decisions: 2\n‚Ä¢ Confirmation quality: 94% Tier 1-2\n\nFull report available anytime.", time:'2:05 PM', delay:2000 }
        ],
        chips: [
          { label:'View Full Report', action:'openPanel' },
          { label:'Restart Demo', action:'restart' }
        ]
      }
    };

    // ===== SCENE CONTEXT INFO (for design panel) =====
    const SCENE_INFO = {
      start: {
        title:'Shift Start Notification', channel:'SMS', channelColor:'bg-gray-500',
        why:'Summary notification ‚Äî no interaction needed. Low cost.',
        auto:['SSS detected 14/16 via badge + geofence','Auto-confirmed high-confidence employees','Flagged 2 anomalous patterns for review'],
        design:'SMS is used here because the message is purely informational. Sal doesn\'t need to act on this message ‚Äî it just primes her that a review is coming.'
      },
      review: {
        title:'Employee Review Carousel', channel:'RCS', channelColor:'bg-teal-600',
        why:'Rich cards + suggested actions eliminate typing. This is THE high-value decision point.',
        auto:['Compiled employee profiles with context','Pulled 30-day absence history','Pre-calculated risk level and points','Sorted by urgency (highest risk first)'],
        design:'RCS earns its cost here. Each card shows everything Sal needs to decide ‚Äî photo, status, history, points ‚Äî with one-tap actions. No typing, no navigation, no dashboard lookup.'
      },
      'maria-ncns': {
        title:'NCNS Confirmation + Points', channel:'RCS', channelColor:'bg-teal-600',
        why:'Confirmation response with points impact ‚Äî still in the RCS decision window.',
        auto:['Applied +3 NCNS points automatically','Calculated new total (7 pts)','Identified proximity to threshold','Queued Kevin for next review'],
        design:'The agent does the points math instantly and surfaces the impact in the same response. Sal never has to look up a points table.'
      },
      'maria-excused': {
        title:'Excused Absence Confirmation', channel:'RCS', channelColor:'bg-teal-600',
        why:'Simple confirmation, moving to next employee.',
        auto:['Recorded excused absence ‚Äî no points','Noted for attendance pattern tracking','Queued Kevin for review'],
        design:'Even simple confirmations create valuable data. The "excused" judgment is now a Tier 1 confirmation in the system.'
      },
      'kevin-late': {
        title:'Late Confirmation + Points Alert', channel:'RCS ‚Üí RCS', channelColor:'bg-teal-600',
        why:'Points alert is a decision moment ‚Äî Sal needs to act on the threshold warning.',
        auto:['Applied +1 late arrival point','Detected Maria approaching threshold','Generated proactive HR alert suggestion','Pre-drafted HR notification'],
        design:'The agent proactively connects the dots: NCNS ‚Üí points ‚Üí threshold proximity ‚Üí HR notification. Sal doesn\'t have to remember policy rules.'
      },
      'kevin-ontime': {
        title:'On-Time Confirmation + Alert', channel:'SMS ‚Üí RCS', channelColor:'bg-teal-600',
        why:'Kevin is simple (SMS), but Maria\'s threshold alert needs rich interaction (RCS).',
        auto:['Kevin confirmed with no points','Detected Maria threshold proximity','Generated HR alert'],
        design:'Notice the channel switch: Kevin\'s confirmation is SMS (informational), Maria\'s alert is RCS (decision needed).'
      },
      'notify-hr': {
        title:'HR Notification + Backfill', channel:'SMS ‚Üí RCS', channelColor:'bg-teal-600',
        why:'HR notification is SMS (confirmation). Backfill selection needs rich cards (RCS).',
        auto:['Sent HR notification with full context','Queried available qualified employees','Ranked by acceptance rate and availability','Generated backfill cards'],
        design:'Two channel costs in one exchange: cheap SMS for the HR notification, RCS for the backfill carousel where rich cards help Sal choose fast.'
      },
      'hold-hr': {
        title:'Deferred HR + Backfill', channel:'SMS ‚Üí RCS', channelColor:'bg-teal-600',
        why:'Sal\'s choice is respected. Agent still handles coverage.',
        auto:['Flagged for follow-up tracking','Still presents backfill options'],
        design:'The agent respects Sal\'s judgment but doesn\'t let the coverage gap linger. Operational continuity matters even if HR escalation is deferred.'
      },
      'add-note': {
        title:'Contextual Note', channel:'RCS', channelColor:'bg-teal-600',
        why:'Rich chips help Sal add context without typing.',
        auto:['Suggested common context patterns','Will attach note to HR notification'],
        design:'The suggested notes are based on Maria\'s actual pattern data. The agent helps Sal articulate what it already detected.'
      },
      'note-added': {
        title:'Note Saved + Backfill', channel:'SMS ‚Üí RCS', channelColor:'bg-teal-600',
        why:'Confirmation is SMS, backfill selection is RCS.',
        auto:['Saved note to Maria\'s record','Included context in HR notification','Generated backfill options'],
        design:'Sal\'s contextual note now enriches the HR notification. The data gets better because the system made it easy to add.'
      },
      backfill: {
        title:'Backfill Selection', channel:'RCS', channelColor:'bg-teal-600',
        why:'Choosing between candidates benefits from rich cards with stats.',
        auto:['Found qualified employees','Calculated acceptance rates','Ranked by likelihood of acceptance'],
        design:'The acceptance rate stat is key ‚Äî it helps Sal pick the candidate most likely to say yes, reducing time-to-coverage.'
      },
      'text-lisa': {
        title:'Backfill Request Sent', channel:'SMS', channelColor:'bg-gray-500',
        why:'Simple confirmation ‚Äî no interaction needed.',
        auto:['Sent personalized backfill text to Lisa','Tracking response time','Will auto-escalate to Tom if no response in 15 min'],
        design:'Back to SMS ‚Äî this is just a status update. The agent handles the outreach and monitoring autonomously.'
      },
      'text-tom': {
        title:'Backfill Request Sent', channel:'SMS', channelColor:'bg-gray-500',
        why:'Simple confirmation.',
        auto:['Sent backfill text to Tom','Tracking response'],
        design:'SMS for status updates. The agent does the work.'
      },
      'lisa-accepted': {
        title:'Backfill Confirmed', channel:'SMS', channelColor:'bg-gray-500',
        why:'Good news ‚Äî no action needed from Sal.',
        auto:['Lisa confirmed via text','Updated shift roster','Calculated arrival time','Notified Line A lead'],
        design:'SMS is perfect here. The agent resolved the coverage gap end-to-end. Sal just gets the outcome.'
      },
      'tom-accepted': {
        title:'Backfill Confirmed', channel:'SMS', channelColor:'bg-gray-500',
        why:'Status update ‚Äî informational only.',
        auto:['Tom confirmed shift switch','Updated roster','Coordinated with his current supervisor'],
        design:'Pure information. SMS.'
      },
      summary: {
        title:'Shift Summary', channel:'SMS', channelColor:'bg-gray-500',
        why:'End-of-day recap. No action needed.',
        auto:['Compiled full shift statistics','Calculated confirmation quality tiers','Generated audit-ready report','Identified patterns for next shift'],
        design:'The summary shows the split: 14 auto-confirmed (system), 2 supervisor decisions. This ratio is the product\'s core value metric.'
      }
    };

    // ===== HR ACTIVITY FEED =====
    const HR_FEED = [
      { time:'5:55 AM', type:'auto', text:'SSS detected 14 employees on-site via badge/geofence data' },
      { time:'5:55 AM', type:'auto', text:'Auto-confirmed 14 employees (Tier 3 ‚Äî Implicit Confirmation)' },
      { time:'5:55 AM', type:'auto', text:'Flagged Maria Garcia ‚Äî no badge, no call-in, no text' },
      { time:'5:55 AM', type:'auto', text:'Flagged Kevin Park ‚Äî badge swipe at 6:47 AM (late)' },
      { time:'5:58 AM', type:'auto', text:'Sent shift review to Supervisor Sal via SMS + RCS' },
      { time:'5:59 AM', type:'human', text:'Sal marked Maria Garcia as No-Call/No-Show' },
      { time:'5:59 AM', type:'auto', text:'Applied +3 points to Maria Garcia (6 ‚Üí 7 total)' },
      { time:'6:00 AM', type:'human', text:'Sal marked Kevin Park as Present (Late Arrival)' },
      { time:'6:00 AM', type:'auto', text:'Applied +1 point to Kevin Park (1 ‚Üí 2 total)' },
      { time:'6:00 AM', type:'auto', text:'Detected Maria Garcia approaching Written Warning threshold (7/8 pts)' },
      { time:'6:01 AM', type:'human', text:'Sal approved HR notification for Maria Garcia' },
      { time:'6:01 AM', type:'auto', text:'Sent HR alert with supervisor context re: Maria Garcia' },
      { time:'6:01 AM', type:'auto', text:'Identified 2 backfill candidates for Line A (Lisa Chen, Tom Davis)' },
      { time:'6:02 AM', type:'human', text:'Sal selected Lisa Chen for backfill' },
      { time:'6:02 AM', type:'auto', text:'Sent backfill request to Lisa Chen via SMS' },
      { time:'6:15 AM', type:'auto', text:'Lisa Chen accepted backfill ‚Äî arrival ETA 7:15 AM' },
      { time:'6:15 AM', type:'auto', text:'Updated shift roster ‚Äî Line A coverage confirmed' },
      { time:'2:05 PM', type:'auto', text:'Generated shift summary: 94% Tier 1-2 confirmation quality' },
    ];

    // ===== SHARED COMPONENTS =====
    const ChannelBadge = ({ ch }) => (
      <span className={`text-[10px] font-semibold px-1.5 py-0.5 rounded ${ch === 'rcs' ? 'bg-teal-100 text-teal-700' : 'bg-gray-100 text-gray-500'}`}>
        {ch.toUpperCase()}
      </span>
    );

    const TypingDots = () => (
      <div className="flex items-end gap-2 mb-3 animate-fadeIn px-3">
        <div className="w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0" style={{background:B.teal}}>
          <span className="text-white text-[10px] font-bold">TS</span>
        </div>
        <div className="bg-gray-100 rounded-2xl rounded-bl-sm px-4 py-3 flex gap-1.5">
          <div className="w-2 h-2 bg-gray-400 rounded-full typing-dot"/>
          <div className="w-2 h-2 bg-gray-400 rounded-full typing-dot"/>
          <div className="w-2 h-2 bg-gray-400 rounded-full typing-dot"/>
        </div>
      </div>
    );

    // ===== RCS RICH CARD =====
    const RichCard = ({ card }) => (
      <div className="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden" style={{width:'248px'}}>
        <div className={`h-1.5 ${card.barCls}`}/>
        <div className="p-3">
          <div className="flex items-center gap-2 mb-2">
            <div className={`w-9 h-9 rounded-full flex items-center justify-center text-white font-bold text-xs ${card.avatarBg}`}>
              {card.avatar}
            </div>
            <div>
              <div className="font-semibold text-sm leading-tight">{card.name}</div>
              <div className="text-[11px] text-gray-500">{card.role}</div>
            </div>
          </div>
          <div className={`inline-block px-2 py-0.5 rounded-full text-[11px] font-medium ${card.statusCls}`}>
            {card.status}
          </div>
          <div className="text-[11px] text-gray-500 mt-1.5">{card.detail}</div>
          {card.points !== undefined && (
            <div className="mt-2">
              <div className="flex justify-between text-[11px] mb-0.5">
                <span className="text-gray-500">Points</span>
                <span className="font-semibold">{card.points}/8</span>
              </div>
              <div className="h-1.5 bg-gray-200 rounded-full overflow-hidden">
                <div className={`h-full rounded-full ${card.points >= 6 ? 'bg-red-400' : card.points >= 4 ? 'bg-yellow-400' : 'bg-green-400'}`} style={{width:`${(card.points/8)*100}%`}}/>
              </div>
            </div>
          )}
          {card.badge && (
            <div className={`mt-2 inline-block px-2 py-0.5 rounded text-[10px] font-semibold ${card.badgeCls}`}>
              ‚òÖ {card.badge}
            </div>
          )}
        </div>
      </div>
    );

    // ===== CHAT MESSAGE =====
    const ChatMessage = ({ msg }) => {
      if (msg.from === 'user') {
        return (
          <div className="flex justify-end mb-3 animate-fadeIn px-3">
            <div className="max-w-[80%]">
              <div className="rounded-2xl rounded-br-sm px-3.5 py-2.5 text-white text-sm" style={{background:B.teal}}>
                {msg.text}
              </div>
              <div className="text-[10px] text-gray-400 text-right mt-0.5 pr-1">{msg.time}</div>
            </div>
          </div>
        );
      }
      // Agent message
      const isAlert = msg.type === 'alert';
      const isCarousel = msg.type === 'carousel';

      return (
        <div className="mb-3 animate-fadeIn">
          {/* Text messages */}
          {!isCarousel && (
            <div className="flex items-end gap-2 px-3">
              <div className="w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0" style={{background:B.teal}}>
                <span className="text-white text-[10px] font-bold">TS</span>
              </div>
              <div className="max-w-[80%]">
                <div className={`rounded-2xl rounded-bl-sm px-3.5 py-2.5 text-sm whitespace-pre-line ${isAlert ? 'bg-orange-50 border border-orange-200' : 'bg-gray-100'}`}>
                  {msg.text}
                </div>
                <div className="flex items-center gap-1.5 mt-0.5 pl-1">
                  <span className="text-[10px] text-gray-400">{msg.time}</span>
                  <ChannelBadge ch={msg.ch}/>
                </div>
              </div>
            </div>
          )}
          {/* Carousel */}
          {isCarousel && (
            <div className="pl-12">
              <div className="carousel-wrap pr-3">
                {msg.cards.map((card, i) => (
                  <div key={i} className="carousel-item">
                    <RichCard card={card}/>
                  </div>
                ))}
              </div>
              <div className="flex items-center gap-1.5 mt-1 pl-1">
                <span className="text-[10px] text-gray-400">{msg.time}</span>
                <ChannelBadge ch={msg.ch}/>
                <span className="text-[10px] text-gray-400">‚Üî swipe</span>
              </div>
            </div>
          )}
        </div>
      );
    };

    // ===== CHIP BAR =====
    const ChipBar = ({ chips, onChip }) => (
      <div className="flex flex-wrap gap-2 px-3 py-2">
        {chips.map((chip, i) => (
          <button key={i} onClick={() => onChip(chip)}
            className="chip-pop px-3 py-1.5 rounded-full text-sm font-medium border-2 transition-all hover:text-white"
            style={{borderColor:B.teal, color:B.teal}}
            onMouseEnter={e => { e.target.style.background=B.teal; e.target.style.color='#fff'; }}
            onMouseLeave={e => { e.target.style.background='transparent'; e.target.style.color=B.teal; }}>
            {chip.label}
          </button>
        ))}
      </div>
    );

    // ===== PHONE FRAME =====
    const PhoneFrame = ({ children, title }) => (
      <div className="flex-shrink-0">
        <div style={{width:'390px', height:'740px', borderRadius:'40px', border:'8px solid #1a1a1a', background:'#fff', overflow:'hidden', boxShadow:'0 25px 50px rgba(0,0,0,0.15)'}}>
          {/* Status bar */}
          <div className="flex justify-between items-center px-6 py-1.5 text-xs font-semibold" style={{background:'#1a1a1a', color:'#fff'}}>
            <span>9:41</span>
            <div className="flex gap-1">
              <span>‚óè‚óè‚óè‚óè</span>
              <span>üîã</span>
            </div>
          </div>
          {/* Chat header */}
          <div className="flex items-center gap-3 px-4 py-3 border-b" style={{background:B.teal}}>
            <div className="w-9 h-9 rounded-full bg-white/20 flex items-center justify-center">
              <Icons.shield size={18} cls="text-white"/>
            </div>
            <div className="flex-1">
              <div className="flex items-center gap-1.5">
                <span className="text-white font-bold text-sm">{title || 'TeamSense'}</span>
                <svg width="14" height="14" viewBox="0 0 24 24" fill="#6DAEA2"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>
              </div>
              <span className="text-white/70 text-xs">Verified Business</span>
            </div>
            <Icons.phone size={18} cls="text-white/70"/>
          </div>
          {children}
        </div>
      </div>
    );

    // ===== DATA PANEL (inline table view) =====
    const DataPanel = ({ onClose }) => {
      const statusCls = (s) => {
        if (s === 'NCNS') return 'bg-red-100 text-red-700';
        if (s === 'Present (Late)') return 'bg-yellow-100 text-yellow-700';
        if (s === 'Backfill') return 'bg-blue-100 text-blue-700';
        return 'bg-green-100 text-green-700';
      };
      const tierCls = (t) => {
        if (t === 'Tier 1') return 'bg-emerald-100 text-emerald-700';
        if (t === 'Tier 2') return 'bg-teal-100 text-teal-700';
        return 'bg-gray-100 text-gray-600';
      };
      return (
        <div className="absolute inset-0 bg-white panel-slide flex flex-col" style={{top:'85px', borderTopLeftRadius:'16px', borderTopRightRadius:'16px', boxShadow:'0 -4px 20px rgba(0,0,0,0.1)'}}>
          <div className="flex items-center justify-between px-4 py-3 border-b">
            <span className="font-bold text-sm" style={{color:B.teal}}>Shift Overview ‚Äî Line A/B</span>
            <button onClick={onClose} className="p-1 rounded-full hover:bg-gray-100"><Icons.x size={18}/></button>
          </div>
          <div className="flex-1 overflow-auto p-3">
            <table className="w-full text-[11px]">
              <thead>
                <tr className="text-left text-gray-500 border-b">
                  <th className="pb-2 font-medium">Employee</th>
                  <th className="pb-2 font-medium">Status</th>
                  <th className="pb-2 font-medium">Tier</th>
                  <th className="pb-2 font-medium">Pts</th>
                  <th className="pb-2 font-medium">By</th>
                </tr>
              </thead>
              <tbody>
                {SHIFT_DATA.map((r, i) => (
                  <tr key={i} className="border-b border-gray-50">
                    <td className="py-1.5 font-medium">{r.name}</td>
                    <td className="py-1.5"><span className={`px-1.5 py-0.5 rounded text-[10px] font-medium ${statusCls(r.status)}`}>{r.status}</span></td>
                    <td className="py-1.5"><span className={`px-1.5 py-0.5 rounded text-[10px] font-medium ${tierCls(r.tier)}`}>{r.tier}</span></td>
                    <td className="py-1.5 font-medium">{r.points}</td>
                    <td className="py-1.5 text-gray-500">{r.by}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    };

    // ===== CONTEXT PANEL =====
    const ContextPanel = ({ sceneId }) => {
      const info = SCENE_INFO[sceneId] || SCENE_INFO['start'];
      return (
        <div className="flex-1 min-w-[320px] max-w-[420px]">
          <div className="bg-white rounded-2xl shadow-sm border p-5 h-full">
            <div className="flex items-center gap-2 mb-4">
              <div className="w-8 h-8 rounded-lg flex items-center justify-center" style={{background:B.offWhite}}>
                <Icons.msg size={16} cls="text-teal-700"/>
              </div>
              <div>
                <h3 className="font-bold text-sm" style={{color:B.teal}}>Design Context</h3>
                <p className="text-[11px] text-gray-500">For engineering & design review</p>
              </div>
            </div>

            {/* Current scene */}
            <div className="mb-4">
              <div className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1.5">Current Step</div>
              <div className="font-bold" style={{color:B.teal}}>{info.title}</div>
            </div>

            {/* Channel */}
            <div className="mb-4">
              <div className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1.5">Channel</div>
              <div className="flex items-center gap-2">
                <span className={`px-2 py-0.5 rounded-full text-xs font-bold text-white ${info.channelColor}`}>
                  {info.channel}
                </span>
                <span className="text-xs text-gray-600">{info.why}</span>
              </div>
            </div>

            {/* What the system did */}
            <div className="mb-4">
              <div className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1.5">Agent Auto-Actions</div>
              <div className="space-y-1.5">
                {info.auto.map((a, i) => (
                  <div key={i} className="flex items-start gap-2 text-xs">
                    <span className="flex-shrink-0 w-4 h-4 rounded bg-teal-50 flex items-center justify-center mt-0.5">
                      <Icons.bot size={10} cls="text-teal-600"/>
                    </span>
                    <span className="text-gray-700">{a}</span>
                  </div>
                ))}
              </div>
            </div>

            {/* Design rationale */}
            <div>
              <div className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1.5">Design Rationale</div>
              <p className="text-xs text-gray-600 leading-relaxed bg-gray-50 rounded-lg p-3">
                {info.design}
              </p>
            </div>

            {/* Legend */}
            <div className="mt-5 pt-4 border-t">
              <div className="text-[10px] font-semibold text-gray-400 uppercase tracking-wide mb-2">Channel Legend</div>
              <div className="flex gap-4">
                <div className="flex items-center gap-1.5">
                  <span className="px-1.5 py-0.5 rounded text-[10px] font-semibold bg-gray-100 text-gray-500">SMS</span>
                  <span className="text-[11px] text-gray-500">Information only</span>
                </div>
                <div className="flex items-center gap-1.5">
                  <span className="px-1.5 py-0.5 rounded text-[10px] font-semibold bg-teal-100 text-teal-700">RCS</span>
                  <span className="text-[11px] text-gray-500">Decision required</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // ===== SUPERVISOR CHAT =====
    function SupervisorChat() {
      const [messages, setMessages] = useState([]);
      const [chips, setChips] = useState([]);
      const [typing, setTyping] = useState(false);
      const [scene, setScene] = useState('start');
      const [showPanel, setShowPanel] = useState(false);
      const chatRef = useRef(null);
      const timeoutsRef = useRef([]);
      const startedRef = useRef(false);

      const clearAllTimeouts = () => {
        timeoutsRef.current.forEach(id => clearTimeout(id));
        timeoutsRef.current = [];
      };
      const sched = (fn, ms) => {
        const id = setTimeout(fn, ms);
        timeoutsRef.current.push(id);
        return id;
      };

      useEffect(() => {
        if (chatRef.current) chatRef.current.scrollTop = chatRef.current.scrollHeight;
      }, [messages, typing]);

      useEffect(() => {
        if (startedRef.current) return;
        startedRef.current = true;
        playScene('start', null);
        return () => clearAllTimeouts();
      }, []);

      const playScene = (sceneId, userMsg) => {
        setChips([]);
        const sc = SCENES[sceneId];
        if (!sc) return;

        let delay = 0;

        // User message
        if (userMsg) {
          setMessages(prev => [...prev, { from:'user', text:userMsg, time: new Date().toLocaleTimeString([], {hour:'numeric', minute:'2-digit'}), id:'u-'+Date.now() }]);
          delay = 600;
        }

        // Agent messages with typing
        sc.messages.forEach((msg, i) => {
          sched(() => setTyping(true), delay);
          delay += (msg.delay || 1200);
          const m = {...msg, id: sceneId+'-'+i+'-'+Date.now()};
          sched(() => {
            setTyping(false);
            setMessages(prev => [...prev, m]);
          }, delay);
          delay += 350;
        });

        // Chips
        if (sc.chips) {
          sched(() => setChips(sc.chips), delay + 200);
        }

        // Update scene for context panel
        sched(() => setScene(sceneId), 100);

        // Auto-advance
        if (sc.autoNext) {
          sched(() => playScene(sc.autoNext, null), delay + (sc.autoDelay || 2000));
        }
      };

      const handleChip = (chip) => {
        if (chip.action === 'openPanel') { setShowPanel(true); setChips([]); return; }
        if (chip.action === 'restart') { restart(); return; }
        playScene(chip.next, chip.userMsg);
      };

      const restart = () => {
        clearAllTimeouts();
        setMessages([]);
        setChips([]);
        setTyping(false);
        setShowPanel(false);
        setScene('start');
        startedRef.current = false;
        sched(() => {
          startedRef.current = true;
          playScene('start', null);
        }, 500);
      };

      return (
        <div className="flex gap-6 items-start justify-center p-6">
          {/* Phone */}
          <PhoneFrame title="TeamSense">
            <div className="relative flex flex-col" style={{height:'calc(100% - 85px)'}}>
              {/* Chat area */}
              <div ref={chatRef} className="flex-1 overflow-y-auto chat-scroll py-3" style={{background:'#fafafa'}}>
                {/* Auto-confirmed banner */}
                {messages.length > 0 && (
                  <div className="flex justify-center mb-3">
                    <div className="bg-green-50 border border-green-200 rounded-full px-3 py-1 text-[11px] text-green-700 font-medium">
                      ‚úì 14 employees auto-confirmed via badge data
                    </div>
                  </div>
                )}
                {messages.map(msg => <ChatMessage key={msg.id} msg={msg}/>)}
                {typing && <TypingDots/>}
              </div>

              {/* Chips */}
              {chips.length > 0 && (
                <div className="border-t bg-white">
                  <ChipBar chips={chips} onChip={handleChip}/>
                </div>
              )}

              {/* Data panel overlay */}
              {showPanel && <DataPanel onClose={() => {
                setShowPanel(false);
                setChips([{ label:'Restart Demo', action:'restart' }]);
              }}/>}
            </div>
          </PhoneFrame>

          {/* Context panel */}
          <ContextPanel sceneId={scene}/>
        </div>
      );
    }

    // ===== HR DASHBOARD =====
    function HRDashboard() {
      const autoCount = HR_FEED.filter(e => e.type === 'auto').length;
      const humanCount = HR_FEED.filter(e => e.type === 'human').length;

      const statusCls = (s) => {
        if (s === 'NCNS') return 'bg-red-100 text-red-700';
        if (s.includes('Late')) return 'bg-yellow-100 text-yellow-700';
        if (s === 'Backfill') return 'bg-blue-100 text-blue-700';
        return 'bg-green-100 text-green-700';
      };
      const tierCls = (t) => {
        if (t === 'Tier 1') return 'bg-emerald-100 text-emerald-700';
        if (t === 'Tier 2') return 'bg-teal-100 text-teal-700';
        return 'bg-gray-100 text-gray-600';
      };

      return (
        <div className="max-w-6xl mx-auto p-6">
          {/* Stats bar */}
          <div className="grid grid-cols-4 gap-4 mb-6">
            {[
              { label:'Total Employees', value:'16', sub:'Line A + Line B', icon: Icons.users, color:'bg-teal-50 text-teal-700' },
              { label:'Auto-Confirmed', value:'14 (87%)', sub:'Tier 3 ‚Äî Implicit', icon: Icons.bot, color:'bg-green-50 text-green-700' },
              { label:'Supervisor Decisions', value:'2', sub:'Tier 1 ‚Äî Active Correction', icon: Icons.user, color:'bg-blue-50 text-blue-700' },
              { label:'Confirmation Quality', value:'94%', sub:'Tier 1-2 rate', icon: Icons.shield, color:'bg-emerald-50 text-emerald-700' }
            ].map((stat, i) => (
              <div key={i} className="bg-white rounded-xl border p-4">
                <div className="flex items-center gap-3">
                  <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${stat.color}`}>
                    <stat.icon size={20}/>
                  </div>
                  <div>
                    <div className="text-xs text-gray-500">{stat.label}</div>
                    <div className="text-xl font-bold" style={{color:B.teal}}>{stat.value}</div>
                    <div className="text-[11px] text-gray-400">{stat.sub}</div>
                  </div>
                </div>
              </div>
            ))}
          </div>

          <div className="grid grid-cols-5 gap-6">
            {/* Activity feed */}
            <div className="col-span-2 bg-white rounded-xl border p-4">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-bold" style={{color:B.teal}}>Activity Feed</h3>
                <div className="flex gap-2 text-[11px]">
                  <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-teal-400 inline-block"/> Agent</span>
                  <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-blue-400 inline-block"/> Supervisor</span>
                </div>
              </div>
              <div className="space-y-2 max-h-[500px] overflow-y-auto">
                {HR_FEED.map((entry, i) => (
                  <div key={i} className="flex items-start gap-2">
                    <div className={`w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5 ${entry.type === 'auto' ? 'bg-teal-100' : 'bg-blue-100'}`}>
                      {entry.type === 'auto'
                        ? <Icons.bot size={11} cls="text-teal-600"/>
                        : <Icons.user size={11} cls="text-blue-600"/>}
                    </div>
                    <div className="flex-1 min-w-0">
                      <div className="text-xs text-gray-700">{entry.text}</div>
                      <div className="text-[10px] text-gray-400">{entry.time}</div>
                    </div>
                  </div>
                ))}
              </div>
              {/* Ratio */}
              <div className="mt-4 pt-3 border-t">
                <div className="text-xs text-gray-500 mb-1.5">Automation Ratio</div>
                <div className="flex gap-0.5 h-3 rounded-full overflow-hidden">
                  <div className="bg-teal-400 rounded-l-full" style={{width:`${autoCount/(autoCount+humanCount)*100}%`}}/>
                  <div className="bg-blue-400 rounded-r-full" style={{width:`${humanCount/(autoCount+humanCount)*100}%`}}/>
                </div>
                <div className="flex justify-between text-[11px] mt-1">
                  <span className="text-teal-600 font-medium">{autoCount} automated</span>
                  <span className="text-blue-600 font-medium">{humanCount} supervisor</span>
                </div>
              </div>
            </div>

            {/* Shift overview table */}
            <div className="col-span-3 bg-white rounded-xl border p-4">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-bold" style={{color:B.teal}}>Shift Overview ‚Äî Feb 12</h3>
                <div className="flex gap-2">
                  <span className="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600 font-medium">Line A</span>
                  <span className="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600 font-medium">Line B</span>
                </div>
              </div>
              <div className="overflow-auto">
                <table className="w-full text-xs">
                  <thead>
                    <tr className="text-left text-gray-500 border-b">
                      <th className="pb-2 font-medium">Employee</th>
                      <th className="pb-2 font-medium">Dept</th>
                      <th className="pb-2 font-medium">Badge Time</th>
                      <th className="pb-2 font-medium">Status</th>
                      <th className="pb-2 font-medium">Tier</th>
                      <th className="pb-2 font-medium">Points</th>
                      <th className="pb-2 font-medium">Confirmed By</th>
                    </tr>
                  </thead>
                  <tbody>
                    {SHIFT_DATA.map((r, i) => (
                      <tr key={i} className={`border-b border-gray-50 ${r.status === 'NCNS' ? 'bg-red-50/50' : ''}`}>
                        <td className="py-2 font-medium">{r.name}</td>
                        <td className="py-2 text-gray-500">{r.dept}</td>
                        <td className="py-2 text-gray-500">{r.time}</td>
                        <td className="py-2"><span className={`px-2 py-0.5 rounded-full text-[11px] font-medium ${statusCls(r.status)}`}>{r.status}</span></td>
                        <td className="py-2"><span className={`px-1.5 py-0.5 rounded text-[11px] font-medium ${tierCls(r.tier)}`}>{r.tier}</span></td>
                        <td className="py-2">
                          <span className={`font-semibold ${r.points >= 6 ? 'text-red-600' : r.points >= 4 ? 'text-yellow-600' : 'text-gray-700'}`}>{r.points}</span>
                        </td>
                        <td className="py-2">
                          <span className={`text-[11px] ${r.by === 'Auto' ? 'text-teal-600' : 'text-blue-600'} font-medium`}>{r.by}</span>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>

              {/* Confirmation quality breakdown */}
              <div className="mt-4 pt-3 border-t">
                <div className="text-xs font-semibold text-gray-500 mb-2">Confirmation Quality Breakdown</div>
                <div className="grid grid-cols-4 gap-3">
                  {[
                    { tier:'Tier 1', label:'Actively Corrected', count:2, pct:'12.5%', cls:'bg-emerald-500' },
                    { tier:'Tier 2', label:'Confirmed + Acted', count:1, pct:'6.25%', cls:'bg-teal-500' },
                    { tier:'Tier 3', label:'Implicitly Confirmed', count:13, pct:'81.25%', cls:'bg-gray-400' },
                    { tier:'Tier 4', label:'Unconfirmed', count:0, pct:'0%', cls:'bg-red-400' }
                  ].map((t, i) => (
                    <div key={i} className="text-center">
                      <div className={`h-2 rounded-full mb-1 ${t.cls}`} style={{width:`${Math.max(t.count/16*100, 5)}%`, minWidth:'8px', margin:'0 auto'}}/>
                      <div className="font-bold text-sm" style={{color:B.teal}}>{t.count}</div>
                      <div className="text-[11px] font-medium text-gray-600">{t.tier}</div>
                      <div className="text-[10px] text-gray-400">{t.label}</div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ===== EMPLOYEE CHAT =====
    function EmployeeChat() {
      const [messages, setMessages] = useState([]);
      const [chips, setChips] = useState([]);
      const [typing, setTyping] = useState(false);
      const chatRef = useRef(null);
      const timeoutsRef = useRef([]);
      const startedRef = useRef(false);

      const sched = (fn, ms) => { const id = setTimeout(fn, ms); timeoutsRef.current.push(id); };

      useEffect(() => {
        if (chatRef.current) chatRef.current.scrollTop = chatRef.current.scrollHeight;
      }, [messages, typing]);

      useEffect(() => {
        if (startedRef.current) return;
        startedRef.current = true;
        sched(() => setChips([
          { label:'Check my points', next:'check-points' },
          { label:'When does a point expire?', next:'expiration' },
          { label:'Am I close to a warning?', next:'threshold' }
        ]), 500);
        return () => timeoutsRef.current.forEach(id => clearTimeout(id));
      }, []);

      const EMP_SCENES = {
        'check-points': {
          messages: [
            { ch:'sms', from:'agent', text:"Hi James! Here's your attendance summary:\n\nCurrent balance: 5 points\nNext threshold: Written Warning (8 pts)\n\nRecent activity:\n‚Ä¢ Oct 15 ‚Äî Late arrival: +1 pt\n‚Ä¢ Nov 2 ‚Äî Absence (no call): +3 pts\n‚Ä¢ Nov 20 ‚Äî Early departure: +1 pt\n\nNext expiration: Apr 15 (‚àí1 pt)", time:'Now', delay:1800 }
          ],
          chips: [
            { label:'When does a point expire?', next:'expiration' },
            { label:'Am I close to a warning?', next:'threshold' }
          ]
        },
        'expiration': {
          messages: [
            { ch:'sms', from:'agent', text:"Your earliest point expires April 15 ‚Äî that's the 1 point from your Oct 15 late arrival.\n\nAfter that, your balance drops to 4 points.\n\nAll points expire 12 months from the incident date.", time:'Now', delay:1500 }
          ],
          chips: [
            { label:'Check my points', next:'check-points' },
            { label:'Am I close to a warning?', next:'threshold' }
          ]
        },
        'threshold': {
          messages: [
            { ch:'sms', from:'agent', text:"You're 3 points away from Written Warning (8 pts).\n\nThat means any of these would cross the threshold:\n‚Ä¢ 3 unexcused late arrivals (+1 pt each)\n‚Ä¢ 1 no-call/no-show (+3 pts)\n\nPlanned absences with PTO don't add points. If you need time off, submit through the app ahead of time.", time:'Now', delay:2000 }
          ],
          chips: [
            { label:'Check my points', next:'check-points' },
            { label:'When does a point expire?', next:'expiration' }
          ]
        }
      };

      const playScene = (sceneId, userMsg) => {
        setChips([]);
        const sc = EMP_SCENES[sceneId];
        if (!sc) return;
        let delay = 0;
        if (userMsg) {
          setMessages(prev => [...prev, { from:'user', text:userMsg, time:'Now', id:'eu-'+Date.now() }]);
          delay = 600;
        }
        sc.messages.forEach((msg, i) => {
          sched(() => setTyping(true), delay);
          delay += (msg.delay || 1200);
          sched(() => {
            setTyping(false);
            setMessages(prev => [...prev, {...msg, id:'em-'+sceneId+'-'+i+'-'+Date.now()}]);
          }, delay);
          delay += 300;
        });
        if (sc.chips) {
          sched(() => setChips(sc.chips), delay + 200);
        }
      };

      const handleChip = (chip) => {
        playScene(chip.next, chip.label);
      };

      return (
        <div className="flex gap-6 items-start justify-center p-6">
          <PhoneFrame title="TeamSense">
            <div className="flex flex-col" style={{height:'calc(100% - 85px)'}}>
              <div ref={chatRef} className="flex-1 overflow-y-auto chat-scroll py-3" style={{background:'#fafafa'}}>
                {messages.length === 0 && !typing && (
                  <div className="flex flex-col items-center justify-center h-full text-center px-6">
                    <div className="w-14 h-14 rounded-full flex items-center justify-center mb-3" style={{background:B.offWhite}}>
                      <Icons.msg size={24} cls="text-teal-600"/>
                    </div>
                    <p className="text-sm font-semibold text-gray-700">Employee Self-Service</p>
                    <p className="text-xs text-gray-500 mt-1">James can text to check his points, understand thresholds, and get actionable guidance ‚Äî all via SMS.</p>
                  </div>
                )}
                {messages.map(msg => <ChatMessage key={msg.id} msg={msg}/>)}
                {typing && <TypingDots/>}
              </div>
              {chips.length > 0 && (
                <div className="border-t bg-white">
                  <ChipBar chips={chips} onChip={handleChip}/>
                </div>
              )}
            </div>
          </PhoneFrame>

          {/* Employee context */}
          <div className="flex-1 min-w-[320px] max-w-[420px]">
            <div className="bg-white rounded-2xl shadow-sm border p-5">
              <div className="flex items-center gap-2 mb-4">
                <div className="w-8 h-8 rounded-lg flex items-center justify-center" style={{background:B.offWhite}}>
                  <Icons.user size={16} cls="text-teal-700"/>
                </div>
                <div>
                  <h3 className="font-bold text-sm" style={{color:B.teal}}>Employee View ‚Äî James Wright</h3>
                  <p className="text-[11px] text-gray-500">Line B ‚Äî Quality Check ¬∑ 5 points</p>
                </div>
              </div>

              <div className="space-y-4">
                <div>
                  <div className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1.5">Channel</div>
                  <div className="flex items-center gap-2">
                    <span className="px-2 py-0.5 rounded-full text-xs font-bold text-white bg-gray-500">SMS</span>
                    <span className="text-xs text-gray-600">Always SMS ‚Äî informational responses only. No RCS cost needed.</span>
                  </div>
                </div>

                <div>
                  <div className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1.5">Key Principle</div>
                  <p className="text-xs text-gray-600 bg-gray-50 rounded-lg p-3 leading-relaxed">
                    Employees get transparent access to their own attendance data through natural conversation. No app download, no portal login ‚Äî just text. This builds trust and reduces "surprise" disciplinary moments.
                  </p>
                </div>

                <div>
                  <div className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1.5">Data Shown</div>
                  <div className="space-y-1">
                    {['Current points balance','Recent infraction history','Point expiration dates','Proximity to next threshold','Actionable guidance (use PTO)'].map((item, i) => (
                      <div key={i} className="flex items-center gap-2 text-xs text-gray-700">
                        <Icons.check size={12} cls="text-teal-500"/>
                        <span>{item}</span>
                      </div>
                    ))}
                  </div>
                </div>

                <div>
                  <div className="text-xs font-semibold text-gray-500 uppercase tracking-wide mb-1.5">What This Enables</div>
                  <p className="text-xs text-gray-600 bg-green-50 rounded-lg p-3 leading-relaxed">
                    When employees know their points balance and understand the rules, they make better decisions. Self-service reduces HR inquiry volume and supports the "Data Birthright" principle ‚Äî your data should be accessible to you.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ===== APP SHELL =====
    function App() {
      const [tab, setTab] = useState('supervisor');

      const tabs = [
        { id:'supervisor', label:'Supervisor (Sal)', icon: Icons.msg },
        { id:'hr', label:'HR Dashboard', icon: Icons.barChart },
        { id:'employee', label:'Employee (James)', icon: Icons.user }
      ];

      return (
        <div className="min-h-screen" style={{background:'#f0f2f5'}}>
          {/* Top bar */}
          <div className="border-b bg-white">
            <div className="max-w-7xl mx-auto px-6 flex items-center justify-between">
              <div className="flex items-center gap-3 py-3">
                <div className="w-8 h-8 rounded-lg flex items-center justify-center" style={{background:B.teal}}>
                  <Icons.shield size={16} cls="text-white"/>
                </div>
                <div>
                  <h1 className="font-bold text-sm" style={{color:B.teal}}>Supervisor Attendance Control Surface</h1>
                  <p className="text-[11px] text-gray-500">Interactive Prototype v2 ‚Äî Agentic + RCS/SMS Hybrid</p>
                </div>
              </div>

              {/* Tabs */}
              <div className="flex">
                {tabs.map(t => (
                  <button key={t.id} onClick={() => setTab(t.id)}
                    className={`flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-all ${
                      tab === t.id
                        ? 'border-teal-600 text-teal-700'
                        : 'border-transparent text-gray-500 hover:text-gray-700'
                    }`}>
                    <t.icon size={16}/>
                    {t.label}
                  </button>
                ))}
              </div>
            </div>
          </div>

          {/* Content */}
          {tab === 'supervisor' && <SupervisorChat key="sup"/>}
          {tab === 'hr' && <HRDashboard/>}
          {tab === 'employee' && <EmployeeChat key="emp"/>}
        </div>
      );
    }

    // ===== RENDER =====
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
